---
import Icon from "@/components/Icon.astro";

// Configuración del Hero
const heroData = {
  // Badge superior
  badge: {
    icon: "shield-check",
    text: "Soluciones de Seguridad Confiables",
  },

  // Título principal
  title: {
    line1: "Protege lo que",
    line2: "Más Importa con",
    highlight: "Seguridad Avanzada",
  },

  // Descripción
  description:
    "Experimente sistemas de seguridad electrónica de última generación diseñados para proteger su hogar y negocio.",

  // Botones CTA
  buttons: {
    primary: {
      text: "Consulta Gratuita",
      icon: "alt-arrow-right",
    },
    secondary: {
      text: "Ver",
      icon: "play",
    },
  },

  // Estadísticas
  stats: [
    {
      value: 500,
      suffix: "+",
      label: "Proyectos Completados",
    },
    {
      value: 24,
      suffix: "/7",
      label: "Soporte de Monitoreo",
    },
    {
      value: 10,
      suffix: "+",
      label: "Años de Experiencia",
    },
  ],

  // Tarjetas flotantes
  floatingCards: [
    {
      position: "right",
      speed: "0.05",
      icon: "eye",
      title: "Vigilancia IA",
      description: "Reconocimiento facial inteligente",
    },
    {
      position: "left",
      speed: "0.08",
      icon: "flame",
      title: "Detección de Incendios",
      description: "Sensores de calor avanzados",
    },
  ],

  // Imágenes del slider
  sliderImages: [
    {
      src: "/img/gvolts/planing-project.png",
      alt: "Professional Security Installation",
    },
    {
      src: "/img/gvolts/extintor.jpg",
      alt: "Security Camera Installation",
    },
    {
      src: "/img/gvolts/camara-bosque.jpg",
      alt: "Security Systems",
    },
  ],

  // Video del modal
  video: {
    src: "/img/gvolts/camara_video.mp4",
  },
};

// Palabras para el efecto typewriter (se usan en el script)
const typewriterWords = [
  "Seguridad Avanzada",
  "Vigilancia Inteligente",
  "Monitoreo 24/7",
  "Respuesta Rápida",
];
---

<section
  class="relative min-h-[100dvh] w-full flex items-center overflow-hidden"
  id="home"
>
  <!-- Background Slider with Overlay -->
  <div class="absolute top-0 left-0 w-full h-[120%] -top-[10%] z-0">
    <!-- Slider Container -->
    <div class="slider-container w-full h-full relative overflow-hidden">
      {
        heroData.sliderImages.map((image, index) => (
          <div class={`slider-slide ${index === 0 ? "active" : ""}`}>
            <img
              src={image.src}
              alt={image.alt}
              class="background-image w-full h-full object-cover object-center will-change-transform"
              loading={index === 0 ? "eager" : "lazy"}
            />
          </div>
        ))
      }
    </div>

    <!-- Overlay siempre visible encima del slider -->
    <div class="hero-overlay absolute top-0 left-0 w-full h-full z-[2]"></div>
  </div>

  <!-- Hero Content -->
  <div
    class="relative z-[3] w-full px-4 pt-32 pb-12 md:px-8 md:pt-32 md:pb-16 flex flex-col justify-center min-h-[100dvh]"
  >
    <div class="max-w-[1400px] mx-auto flex flex-col items-center text-center">
      <!-- Badge -->
      <div
        class="hero-badge inline-flex items-center gap-2 mt-5 bg-indian-red-500 border border-indian-red-500 px-6 py-2 rounded-full text-white text-sm font-semibold mb-8"
      >
        <Icon name={heroData.badge.icon} size="20" />
        <span>{heroData.badge.text}</span>
      </div>

      <!-- Title Decorator -->
      <div class="title-decorator-wrapper">
        <div class="title-decorator-line-left bg-lemon-chiffon"></div>
        <div class="title-decorator bg-lemon-chiffon"></div>
        <div class="title-decorator-line-right bg-lemon-chiffon"></div>
      </div>

      <!-- Main Title -->
      <h1
        class="hero-title text-[clamp(3rem,8vw,4rem)] font-extrabold leading-[1.1] mb-8 max-w-[1100px] tracking-tight"
      >
        <span class="block text-white drop-shadow-sm"
          >{heroData.title.line1}</span
        >
        <span class="block text-white drop-shadow-sm"
          >{heroData.title.line2}</span
        >
        <span class="block relative pb-2">
          <span
            class="typewriter-text bg-gradient-to-r from-lemon-chiffon-500 to-lemon-chiffon-300 bg-clip-text text-transparent"
            >{heroData.title.highlight}</span
          >
          <span
            class="cursor-blink inline-block w-1 h-[clamp(3rem,9vw,6rem)] bg-indian-red-400 ml-1 align-middle"
          ></span>
        </span>
      </h1>

      <!-- Description -->
      <p
        class="hero-description text-[clamp(1.1rem,2.5vw,1.35rem)] leading-[1.8] text-lemon-chiffon-50/90 max-w-[800px] mb-12 font-medium"
      >
        {heroData.description}
      </p>

      <!-- CTA Buttons -->
      <div class="hero-cta flex gap-6 flex-wrap justify-center mb-20">
        <button
          class="cta-primary inline-flex items-center gap-3 bg-indian-red-500 text-white px-10 py-4 rounded-xl text-lg font-bold border-0 cursor-pointer transition-all duration-300 shadow-[0_10px_30px_rgba(205,92,92,0.4)] relative overflow-hidden hover:-translate-y-1 hover:shadow-[0_15px_40px_rgba(205,92,92,0.5)] hover:bg-indian-red-600"
        >
          <span>{heroData.buttons.primary.text}</span>
          <div class="cta-arrow transition-transform duration-300">
            <Icon name={heroData.buttons.primary.icon} size="20" />
          </div>
        </button>
        <button
          class="js-video-modal-trigger inline-flex items-center gap-3 bg-white/10 text-white px-8 py-4 rounded-xl text-lg font-semibold border-2 border-white/20 cursor-pointer transition-all duration-300 backdrop-blur-[10px] hover:bg-white/15 hover:border-white/30 hover:-translate-y-1"
        >
          <div class="text-indian-red-400">
            <Icon name={heroData.buttons.secondary.icon} size="20" />
          </div>
          <span>{heroData.buttons.secondary.text}</span>
        </button>
      </div>

      <!-- Stats -->
      <div
        class="hero-stats flex gap-16 items-center justify-center flex-wrap w-full border-t border-white/10 pt-12"
      >
        {
          heroData.stats.map((stat, index) => (
            <>
              {index > 0 && (
                <div class="w-px h-[60px] bg-gradient-to-b from-transparent via-white/20 to-transparent hidden md:block" />
              )}
              <div class="text-center group hover:-translate-y-1 transition-transform duration-300">
                <div class="text-[clamp(2.5rem,5vw,3.5rem)] font-extrabold text-white leading-none mb-2 group-hover:text-indian-red-200 transition-colors">
                  <span
                    class="counter"
                    data-target={stat.value}
                    data-suffix={stat.suffix}
                  >
                    0
                  </span>
                </div>
                <div class="text-base text-white/70 font-medium">
                  {stat.label}
                </div>
              </div>
            </>
          ))
        }
      </div>
    </div>

    <!-- Floating Feature Cards -->
    {
      heroData.floatingCards.map((card) => (
        <div
          class={`hidden xl:block absolute ${card.position === "right" ? "right-[5%]" : "left-[5%]"} bottom-[20%] z-[3] parallax-card`}
          data-speed={card.speed}
        >
          <div class="bg-white/10 backdrop-blur-[20px] border border-white/20 rounded-[20px] p-6 w-[260px] shadow-[0_20px_60px_rgba(0,0,0,0.3)]">
            <div class="w-12 h-12 bg-indian-red-500 text-white rounded-xl flex items-center justify-center mb-4 shadow-lg shadow-indian-red-500/40">
              <Icon name={card.icon} size="24" />
            </div>
            <h3 class="text-lg font-bold text-white mb-1">{card.title}</h3>
            <p class="text-sm text-white/70">{card.description}</p>
          </div>
        </div>
      ))
    }
  </div>

  <!-- Video Modal -->
  <div
    id="video-modal"
    class="fixed inset-0 z-[9999] hidden opacity-0 transition-opacity duration-300"
  >
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm js-modal-close">
    </div>

    <!-- Modal Content -->
    <div
      class="relative w-full h-full flex items-center justify-center p-4 md:p-8"
    >
      <div
        class="relative w-full max-w-5xl aspect-video bg-black rounded-2xl overflow-hidden shadow-2xl transform scale-95 transition-transform duration-300 modal-content"
      >
        <!-- Close Button -->
        <button
          class="absolute top-4 right-4 z-10 text-white/70 hover:text-white bg-black/50 hover:bg-black/70 rounded-full p-2 transition-colors js-modal-close"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>

        <!-- Video Player -->
        <video
          width="100%"
          height="100%"
          controls
          class="w-full h-full object-cover"
        >
          <source src={heroData.video.src} type="video/mp4" />
          Your browser does not support the video tag.
        </video>
      </div>
    </div>
  </div>
</section>

<style>
  /* Gradiente del overlay - Darker for better text contrast */
  .hero-overlay {
    background: linear-gradient(
      180deg,
      rgba(15, 23, 42, 0.75) 0%,
      rgba(15, 23, 42, 0.65) 50%,
      rgba(15, 23, 42, 0.85) 100%
    );
    pointer-events: none;
  }

  .hero-description {
    text-shadow:
      0 2px 8px rgba(0, 0, 0, 0.7),
      0 1px 3px rgba(0, 0, 0, 0.5);
  }

  .hero-badge {
    text-shadow: 0 1px 4px rgba(0, 0, 0, 0.4);
  }

  /* Línea decorativa encima del título */
  .title-decorator-wrapper {
    position: relative;
    width: clamp(280px, 90%, 900px);
    max-width: 90vw;
    height: clamp(2rem, 5vw, 2rem);
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }

  @media (max-width: 768px) {
    .title-decorator-wrapper {
      width: 90vw;
      max-width: 90vw;
    }
  }

  .title-decorator {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    margin: 0 auto;
    transform: scaleX(0);
    transform-origin: center;
    width: 100%;
    height: 3px;
    border-radius: 2px;
  }

  /* Líneas verticales desde los extremos */
  .title-decorator-line-left,
  .title-decorator-line-right {
    width: 5px;
    height: 350%;
    border-radius: 2px;
    transform: scaleY(0);
    transform-origin: top;
  }

  .title-decorator-line-left {
    position: absolute;
    left: 0;
    top: 0;
  }

  .title-decorator-line-right {
    position: absolute;
    right: 0;
    top: 0;
  }

  .title-line-accent::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 60%;
    height: 6px;
    background: linear-gradient(90deg, transparent, #cd5c5c, transparent);
    border-radius: 3px;
    opacity: 0.8;
  }

  @keyframes blink {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0;
    }
  }

  .cursor-blink {
    animation: blink 1s step-end infinite;
  }

  /* Efecto shine en botón primario */
  .cta-primary::before {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.3),
      transparent
    );
    transition: left 0.6s ease;
  }

  .cta-primary:hover::before {
    left: 100%;
  }

  .cta-primary:hover .cta-arrow {
    transform: translateX(5px);
  }

  /* Animaciones de entrada */
  .hero-badge,
  .hero-title,
  .hero-description,
  .hero-cta,
  .hero-stats {
    opacity: 0; /* Initial state for GSAP */
  }

  /* Slider Styles */
  .slider-container {
    position: relative;
    background-color: #0f172a; /* Fondo base para evitar vacío durante transiciones */
  }

  .slider-slide {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 2s ease-in-out;
    z-index: 0;
  }

  .slider-slide.active {
    opacity: 1;
    z-index: 1;
  }

  /* Modal Styles */
  #video-modal.open {
    display: flex;
    opacity: 1;
  }

  #video-modal.open .modal-content {
    transform: scale(1);
  }
</style>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  document.addEventListener("DOMContentLoaded", () => {
    // Entrance Animations
    const tl = gsap.timeline({ defaults: { ease: "power3.out" } });

    tl.fromTo(
      ".hero-badge",
      { y: 30, opacity: 0 },
      { y: 0, opacity: 1, duration: 0.8 }
    )
      .to(
        ".title-decorator",
        {
          scaleX: 1,
          duration: 0.8,
          ease: "power2.out",
          transformOrigin: "center",
        },
        "-=0.3"
      )
      .to(
        ".title-decorator-line-left, .title-decorator-line-right",
        {
          scaleY: 1,
          duration: 0.6,
          ease: "power2.out",
          transformOrigin: "top",
        },
        "-=0.2"
      )
      .fromTo(
        ".hero-title",
        { y: 40, opacity: 0 },
        { y: 0, opacity: 1, duration: 1 },
        "-=0.4"
      )
      .fromTo(
        ".hero-description",
        { y: 30, opacity: 0 },
        { y: 0, opacity: 1, duration: 0.8 },
        "-=0.8"
      )
      .fromTo(
        ".hero-cta",
        { y: 30, opacity: 0 },
        { y: 0, opacity: 1, duration: 0.8 },
        "-=0.6"
      )
      .fromTo(
        ".hero-stats",
        { y: 30, opacity: 0 },
        { y: 0, opacity: 1, duration: 0.8 },
        "-=0.6"
      );

    // Counter Animation
    const counters = document.querySelectorAll(".counter");
    counters.forEach((counter) => {
      const target = parseInt(counter.getAttribute("data-target") || "0");
      const suffix = counter.getAttribute("data-suffix") || "";
      const obj = { value: 0 };

      gsap.to(obj, {
        value: target,
        duration: 2.5,
        delay: 1.5,
        ease: "power2.out",
        onUpdate: () => {
          counter.textContent = Math.ceil(obj.value) + suffix;
        },
      });
    });

    // Parallax Effect - Enhanced (aplicado a todas las imágenes del slider)
    gsap.utils.toArray(".background-image").forEach((img) => {
      gsap.to(img as Element, {
        yPercent: 50,
        scale: 1.2,
        ease: "none",
        scrollTrigger: {
          trigger: "#home",
          start: "top top",
          end: "bottom top",
          scrub: 1,
        },
      });
    });

    // Floating Cards Parallax
    const cards = document.querySelectorAll(".parallax-card");
    cards.forEach((card) => {
      const speed = card.getAttribute("data-speed");
      gsap.to(card, {
        y: -100 * Number(speed),
        ease: "none",
        scrollTrigger: {
          trigger: "#home",
          start: "top top",
          end: "bottom top",
          scrub: true,
        },
      });
    });

    // Typewriter Effect (Core GSAP Implementation)
    const words = [
      "Seguridad Avanzada",
      "Vigilancia Inteligente",
      "Monitoreo 24/7",
      "Respuesta Rápida",
    ];
    const textElement = document.querySelector(".typewriter-text");
    const cursorElement = document.querySelector(".cursor-blink");
    let wordIndex = 0;

    if (textElement && cursorElement) {
      const typeWord = (word: string) => {
        const tl = gsap.timeline();
        const proxy = { length: 0 };

        tl.to(proxy, {
          length: word.length,
          duration: word.length * 0.1,
          ease: "none",
          onUpdate: () => {
            textElement.textContent = word.slice(0, Math.ceil(proxy.length));
          },
        });
        return tl;
      };

      const deleteWord = (word: string) => {
        const tl = gsap.timeline();
        const proxy = { length: word.length };

        tl.to(proxy, {
          length: 0,
          duration: word.length * 0.05,
          ease: "none",
          onUpdate: () => {
            textElement.textContent = word.slice(0, Math.ceil(proxy.length));
          },
        });
        return tl;
      };

      const cycleWords = () => {
        const currentWord = words[wordIndex];
        const nextWordIndex = (wordIndex + 1) % words.length;

        const masterTl = gsap.timeline({
          onComplete: () => {
            wordIndex = nextWordIndex;
            cycleWords();
          },
        });

        masterTl
          .add(typeWord(currentWord))
          .to({}, { duration: 2 })
          .add(deleteWord(currentWord))
          .to({}, { duration: 0.5 });
      };

      // Start the cycle
      setTimeout(() => {
        cycleWords();
      }, 2000);
    }

    // Background Slider
    const slides = document.querySelectorAll(".slider-slide");
    let currentSlide = 0;
    const slideInterval = 5000;

    function nextSlide() {
      slides[currentSlide].classList.remove("active");
      currentSlide = (currentSlide + 1) % slides.length;
      slides[currentSlide].classList.add("active");
    }
    setInterval(nextSlide, slideInterval);

    // Video Modal Logic
    const modal = document.getElementById("video-modal");
    const triggerBtn = document.querySelector(".js-video-modal-trigger");
    const closeBtns = document.querySelectorAll(".js-modal-close");
    const video = modal?.querySelector("video");

    function openModal() {
      if (!modal) return;
      modal.classList.remove("hidden");
      // Force reflow
      void modal.offsetWidth;
      modal.classList.add("open");
      document.body.style.overflow = "hidden"; // Prevent background scrolling

      // Auto-play video
      if (video) {
        video.currentTime = 0;
        video.play().catch((e) => console.log("Autoplay prevented:", e));
      }
    }

    function closeModal() {
      if (!modal) return;
      modal.classList.remove("open");
      document.body.style.overflow = "";

      // Stop video
      if (video) {
        video.pause();
        video.currentTime = 0;
      }

      setTimeout(() => {
        modal.classList.add("hidden");
      }, 300); // Match transition duration
    }

    if (triggerBtn) {
      triggerBtn.addEventListener("click", (e) => {
        e.preventDefault();
        openModal();
      });
    }

    closeBtns.forEach((btn) => {
      btn.addEventListener("click", closeModal);
    });

    // Close on Escape key
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && modal && modal.classList.contains("open")) {
        closeModal();
      }
    });
  });
</script>
