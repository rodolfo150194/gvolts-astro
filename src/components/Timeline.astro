---
interface Step {
  number: number;
  title: string;
  description: string;
  duration?: string;
  deliverable: string;
}

interface Props {
  title: string;
  subtitle: string;
  steps: Step[];
  className?: string;
}

const { title, subtitle, steps, className = "" } = Astro.props;
---

<section class:list={["py-20 relative overflow-hidden", className]}>
  <!-- Decorative background -->
  <div
    class="absolute top-0 right-0 w-96 h-96 bg-indian-red-100 rounded-full blur-[100px] opacity-50"
  >
  </div>

  <div class="container mx-auto px-4 relative z-10">
    <div class="max-w-6xl mx-auto">
      <div class="text-center mb-16">
        <h2
          class="process-title font-display text-5xl md:text-6xl font-bold text-slate-900 mb-4"
        >
          {title}
        </h2>
        <p class="text-xl text-slate-600">{subtitle}</p>
      </div>

      <!-- Timeline -->
      <div class="relative timeline-container">
        <!-- Connecting line (desktop) -->
        <div
          class="hidden lg:block absolute left-1/2 top-0 bottom-0 w-1 bg-linear-to-b from-indian-red-200 via-indian-red-500 to-indian-red-200 -translate-x-1/2 timeline-line"
        >
        </div>

        <div class="space-y-12">
          {
            steps.map((step, index) => (
              <div
                class:list={[
                  "timeline-step flex flex-col lg:flex-row gap-8 items-center",
                  index % 2 === 0 ? "" : "lg:flex-row-reverse",
                ]}
              >
                <!-- Content -->
                <div
                  class:list={[
                    "flex-1",
                  ]}
                >
                  <div class="bg-white p-8 rounded-2xl border-2 border-indian-red-100 hover:border-indian-red-500 transition-all shadow-lg hover:shadow-xl">
                    <div class="flex items-center gap-3 mb-4">
                      <div>
                        <h3 class="text-2xl font-bold text-slate-900">
                          {step.title}
                        </h3>
                        {step.duration && (
                          <span class="text-sm text-indian-red-500 font-semibold">
                            {step.duration}
                          </span>
                        )}
                      </div>
                    </div>
                    <p class="text-slate-600 mb-4">{step.description}</p>
                    <div class="bg-indian-red-50 p-3 rounded-lg">
                      <p class="text-sm text-slate-700">
                        <strong>Entregable:</strong> {step.deliverable}
                      </p>
                    </div>
                  </div>
                </div>

                <!-- Center dot -->
                <div class="hidden lg:flex shrink-0 w-16 h-16 bg-indian-red-500 rounded-full items-center justify-center shadow-lg border-4 border-white relative z-10">
                  <span class="text-white font-bold text-xl">{step.number}</span>
                </div>

                <!-- Spacer -->
                <div class="flex-1 hidden lg:block" />
              </div>
            ))
          }
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", async () => {
    const { gsap } = await import("gsap");
    const { ScrollTrigger } = await import("gsap/ScrollTrigger");
    gsap.registerPlugin(ScrollTrigger);
    // Timeline Line Animation
    gsap.fromTo(
      ".timeline-line",
      { scaleY: 0 },
      {
        scaleY: 1,
        transformOrigin: "top center",
        ease: "none",
        scrollTrigger: {
          trigger: ".timeline-container",
          start: "top 60%",
          end: "bottom 60%",
          scrub: 1,
        },
      }
    );

    // Timeline animations
    ScrollTrigger.batch(".timeline-step", {
      onEnter: (elements) => {
        gsap.from(elements, {
          opacity: 0,
          x: (index, target) => {
            const isEven =
              Array.from(target.parentElement.children).indexOf(target) % 2 ===
              0;
            return isEven ? -100 : 100;
          },
          duration: 0.8,
          stagger: 0.2,
          ease: "power3.out",
        });
      },
      start: "top 80%",
    });
  });
</script>
