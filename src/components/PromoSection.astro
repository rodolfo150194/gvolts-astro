---
import { Tag, TrendingUp } from "@lucide/astro";
import PromoCard from "@/components/PromoCard.astro";
import { getActivePromotions } from "@/services/promotions";
import type { ServiceSlug } from "@/types/promotion";

interface Props {
  title?: string;
  subtitle?: string;
  service?: ServiceSlug;
  maxPromotions?: number;
  showViewAll?: boolean;
  className?: string;
}

const {
  title = "Promociones Especiales",
  subtitle = "Aprovecha nuestras ofertas exclusivas en servicios de seguridad y protecci√≥n",
  service,
  maxPromotions,
  showViewAll = true,
  className = ""
} = Astro.props;

// Fetch active promotions
const { success, data: promotions } = await getActivePromotions(service ? { service } : undefined);

// Limit promotions if maxPromotions is specified
const displayPromotions = maxPromotions && promotions
  ? promotions.slice(0, maxPromotions)
  : promotions;

// Don't render section if no promotions
if (!success || !displayPromotions || displayPromotions.length === 0) {
  return null;
}
---

<section class={`py-16 md:py-24 bg-gradient-to-b from-gray-50 to-white ${className}`}>
  <div class="container mx-auto px-4">
    <!-- Section Header -->
    <div class="text-center mb-12">
      <div class="inline-flex items-center gap-2 bg-indian-red-100 text-indian-red-700 px-4 py-2 rounded-full mb-4">
        <TrendingUp size={20} />
        <span class="font-semibold">Ofertas Limitadas</span>
      </div>

      <h2 class="text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900 mb-4">
        {title}
      </h2>

      <p class="text-lg text-gray-600 max-w-2xl mx-auto">
        {subtitle}
      </p>
    </div>

    <!-- Promotions Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-8">
      {displayPromotions.map((promotion) => (
        <PromoCard promotion={promotion} />
      ))}
    </div>

    <!-- View All Link -->
    {showViewAll && promotions && promotions.length > (maxPromotions || 0) && (
      <div class="text-center">
        <a
          href="/promotions"
          class="inline-flex items-center gap-2 text-indian-red-600 hover:text-indian-red-700 font-semibold text-lg transition-colors"
        >
          <Tag size={20} />
          Ver todas las promociones ({promotions.length})
        </a>
      </div>
    )}
  </div>
</section>

<style>
  /* Add subtle animation on scroll */
  @media (prefers-reduced-motion: no-preference) {
    .grid > * {
      opacity: 0;
      animation: fadeInUp 0.6s ease-out forwards;
    }

    .grid > *:nth-child(1) {
      animation-delay: 0.1s;
    }

    .grid > *:nth-child(2) {
      animation-delay: 0.2s;
    }

    .grid > *:nth-child(3) {
      animation-delay: 0.3s;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  }
</style>
