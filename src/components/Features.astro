---
import Icon from '@/components/Icon.astro';

const features = [
  {
    number: '01',
    title: 'Detección Avanzada',
    description: 'Sistemas de última generación que detectan incendios antes de que se propaguen, utilizando tecnología térmica y análisis de comportamiento.',
    icon: 'eye',
    color: 'text-indian-red-500',
    bg: '',
    mask: '/img/mask-rectangle1.png',
    image: '/img/gvolts/img1.png',
    imageAlt: 'Sistema de detección de incendios',
    decoration: '/img/circle-two-line-vertical.png',
  },
  {
    number: '02',
    title: 'Monitoreo 24/7',
    description: 'Vigilancia constante con respuesta inmediata ante cualquier amenaza. Nuestro centro de control opera ininterrumpidamente para tu tranquilidad.',
    icon: 'shield-check',
    color: 'text-indian-red-600',
    mask: '/img/mask-rectangle2.png',
    bg: '',
    image: '/img/gvolts/img2.png',
    imageAlt: 'Centro de monitoreo 24/7',
    decoration: '/img/circle-three-line-vertical.png'
  },
  {
    number: '03',
    title: 'Instalación Certificada',
    description: 'Técnicos especializados garantizan una instalación perfecta y segura, cumpliendo con todas las normativas internacionales de seguridad.',
    icon: 'tool',
    color: 'text-indian-red-700',
    mask: '/img/mask-rectangle3.png',
    bg: '',
    image: '/img/gvolts/men-install-camera.png',
    imageAlt: 'Técnico certificado instalando sistema',
    decoration: '/img/circle-four-line-vertical.png',
  }
];
---

<section id="features-section" class="relative  w-full max-w-full">
  <!-- Container for horizontal scroll -->
  <div class="features-container h-full w-full max-w-full">
    <div class="features-wrapper flex h-full w-[300vw] max-w-[300vw]">
      {features.map((feature, index) => (
        <div class={`feature-item w-screen h-screen flex-shrink-0 flex items-center justify-center relative`}>
            
            {feature.decoration && (
              <img
                src={feature.decoration}
                alt=""
                class="absolute bottom-20 left-20 w-[500px] h-[500px]  object-contain opacity-80 pointer-events-none z-0"
              />
            )}

            <div class="max-w-7xl w-full mx-auto px-8 grid grid-cols-1 lg:grid-cols-2 gap-8 items-center relative z-10 mt-5">

                <div class="space-y-8 feature-content opacity-0 translate-y-10">
                    <div class="inline-flex items-center gap-3 px-4 py-2 rounded-[20px] bg-indian-red-100/50 border border-indian-red-200 text-indian-red-700 font-semibold text-[38px]">
                        <span>{feature.number}</span>
                    </div>

                    <h2 class="text-5xl lg:text-7xl font-bold text-slate-900 leading-tight">
                        {feature.title}
                    </h2>

                    <p class="text-xl text-slate-600 leading-relaxed max-w-xl">
                        {feature.description}
                    </p>
                </div>
                <div class="relative w-full max-w-2xl mx-auto">
                  <div class="relative w-full pt-[100%]" style={`--mask-url: url('${feature.mask}');`}>
                    <img
                      src={feature.image}
                      alt={feature.imageAlt}
                      loading="lazy"
                      class="absolute inset-0 w-full h-full object-cover mask-clip"
                    />
                  </div>
                </div>

            </div>
        </div>
      ))}
    </div>
  </div>

  <!-- Scroll Progress Indicator -->
  <div class="fixed bottom-12 left-1/2 -translate-x-1/2 flex gap-3 z-50">
    {features.map((_, index) => (
        <div class={`scroll-indicator h-1 rounded-full bg-indian-red-200 transition-all duration-500 ease-out ${index === 0 ? 'w-12 bg-indian-red-600' : 'w-8'}`} data-index={index}></div>
    ))}
  </div>
</section>
<style>
.mask-clip {
  -webkit-mask-image: var(--mask-url);
  mask-image: var(--mask-url);

  -webkit-mask-size: contain;
  mask-size: contain;

  -webkit-mask-position: center;
  mask-position: center;
  -webkit-mask-repeat: no-repeat;
  mask-repeat: no-repeat;
}
</style>
</style>
<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  document.addEventListener("DOMContentLoaded", () => {
    const section = document.getElementById("features-section");
    const wrapper = document.querySelector(".features-wrapper");
    const indicators = document.querySelectorAll(".scroll-indicator");
    const items = document.querySelectorAll(".feature-item");

    if (section && wrapper) {
        // Horizontal Scroll Animation
        const scrollTween = gsap.to(wrapper, {
            x: () => -(wrapper.scrollWidth - window.innerWidth),
            ease: "none",
            scrollTrigger: {
                trigger: section,
                pin: true,
                scrub: 1,
                end: () => "+=" + (wrapper.scrollWidth - window.innerWidth),
                invalidateOnRefresh: true,
                onUpdate: (self) => {
                    // Update indicators based on progress
                    const progress = self.progress;
                    const total = items.length - 1;
                    const index = Math.round(progress * total);
                    
                    indicators.forEach((ind, i) => {
                        if (i === index) {
                            ind.classList.add('w-12', 'bg-indian-red-600');
                            ind.classList.remove('w-8', 'bg-indian-red-200');
                        } else {
                            ind.classList.remove('w-12', 'bg-indian-red-600');
                            ind.classList.add('w-8', 'bg-indian-red-200');
                        }
                    });
                }
            }
        });

        // Content Animations for each slide
        items.forEach((item, i) => {
            const content = item.querySelector('.feature-content');
            const image = item.querySelector('.feature-image');

            // Animate content in when the slide comes into view
            gsap.to([content, image], {
                y: 0,
                x: 0,
                opacity: 1,
                duration: 1,
                stagger: 0.2,
                ease: "power3.out",
                scrollTrigger: {
                    trigger: item,
                    containerAnimation: scrollTween,
                    start: "left center",
                    toggleActions: "play reverse play reverse"
                }
            });
        });
    }
  });
</script>

<style>
  /* Blob shape styles for images */
  .image-blob-container {
    border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
    animation: morphBlob 8s ease-in-out infinite;
    isolation: isolate;
  }

  @keyframes morphBlob {
    0% {
      border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
    }
    25% {
      border-radius: 58% 42% 75% 25% / 76% 46% 54% 24%;
    }
    50% {
      border-radius: 50% 50% 33% 67% / 55% 27% 73% 45%;
    }
    75% {
      border-radius: 33% 67% 58% 42% / 63% 68% 32% 37%;
    }
    100% {
      border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
    }
  }
</style>
