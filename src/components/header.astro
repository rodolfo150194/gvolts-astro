---
import Icon from "./Icon.astro";
import { socials } from "../data/socials";
---

<header
  class="fixed top-0 left-0 right-0 z-[1000] transition-all duration-300 w-full max-w-full"
  id="main-header"
>
  <!-- Top Bar: Dark Slate for high contrast -->
  <div
    class="header-top-bar bg-slate-900 text-white py-2 px-4 lg:px-8 hidden md:block"
  >
    <div class="max-w-7xl mx-auto flex justify-between items-center text-sm">
      <div class="flex gap-6">
        <div
          class="flex items-center gap-2 hover:text-indian-red-500 transition-colors cursor-pointer"
        >
          <Icon name="phone" size={16}/>
          <span>+1 (555) 123-4567</span>
        </div>
        <div
          class="flex items-center gap-2 hover:text-indian-red-500 transition-colors cursor-pointer"
        >
          <Icon name="mail" size={16}/>
          <span>info@gvolts.com</span>
        </div>
      </div>
      <div class="flex gap-4">
        {
          socials.map((social) => (
            <a
              href={social.url}
              aria-label={social.ariaLabel}
              class="hover:text-indian-red-500 transition-colors"
              target="_blank"
              rel="noopener noreferrer"
              set:html={social.icon}
            />
          ))
        }
      </div>
    </div>
  </div>

  <!-- Main Header: White with Shadow -->
  <div class="bg-white shadow-md header-second-bar w-full">
    <div class="w-full max-w-full lg:max-w-7xl mx-auto px-4 lg:px-8">
      <div class="flex justify-between items-center h-20 w-full">
        <!-- Logo -->
        <a href="/" class="header-logo flex-shrink-0 flex items-center">
          <img
            src="/img/logo/logo-gvolts.png"
            alt="G-Volts Logo"
            class="h-12 w-auto object-contain"
          />
        </a>

        <!-- Desktop Navigation -->
        <nav class="hidden md:flex items-center gap-8">
          <a
            href="/"
            class="nav-link header-nav-item text-gray-800 font-medium hover:text-indian-red-500 transition-colors relative py-2"
            >Inicio</a
          >
          <a
            href="#services"
            class="nav-link header-nav-item text-gray-800 font-medium hover:text-indian-red-500 transition-colors relative py-2"
            >Servicios</a
          >
          <a
            href="/projects"
            class="nav-link header-nav-item text-gray-800 font-medium hover:text-indian-red-500 transition-colors relative py-2"
            >Proyectos</a
          >
          <a
            href="#how-to-work"
            class="nav-link header-nav-item text-gray-800 font-medium hover:text-indian-red-500 transition-colors relative py-2"
            >Como funciona</a
          >

          <a href="/contact"
            class="header-cta bg-indian-red-500 cursor-pointer text-white px-6 py-2.5 rounded-lg font-bold hover:bg-indian-red-600 transition-[background-color,transform,box-shadow] duration-300 shadow-lg shadow-indian-red-500/30 hover:-translate-y-0.5 active:translate-y-0"
          >
            Contacto
          </a>
        </nav>

        <!-- Mobile Menu Button -->
        <button
          id="mobile-menu-btn"
          class="md:hidden text-gray-800 hover:text-indian-red-500 focus:outline-none p-2"
          aria-label="Toggle menu"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="menu-icon"
            ><line x1="4" x2="20" y1="12" y2="12"></line><line
              x1="4"
              x2="20"
              y1="6"
              y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg
          >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="close-icon hidden"
            ><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg
          >
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu (Hidden by default) -->
  <div
    id="mobile-menu"
    class="md:hidden bg-white border-t border-gray-100 absolute w-full left-0 shadow-lg transform -translate-y-[150%] transition-transform duration-300 -z-10"
  >
    <div class="px-4 py-6 space-y-4 flex flex-col items-center">
      <a
        href="#home"
        class="text-gray-800 font-medium hover:text-indian-red-500 text-lg"
        >Inicio</a
      >
      <a
        href="#about"
        class="text-gray-800 font-medium hover:text-indian-red-500 text-lg"
        >Nosotros</a
      >
      <a
        href="#services"
        class="text-gray-800 font-medium hover:text-indian-red-500 text-lg"
        >Servicios</a
      >
      <a
        href="/projects"
        class="text-gray-800 font-medium hover:text-indian-red-500 text-lg"
        >Proyectos</a
      >
      <a
        href="/contact"
        class="text-gray-800 font-medium hover:text-indian-red-500 text-lg"
        >Contacto</a
      >
      <button
        class="w-full max-w-xs bg-indian-red-500 text-white px-6 py-3 rounded-lg font-bold hover:bg-indian-red-600 transition-colors shadow-md"
      >
        Empezar
      </button>

      <!-- Mobile Socials -->
      <div
        class="flex gap-6 pt-4 border-t border-gray-100 w-full justify-center mt-2"
      >
        {
          socials.map((social) => (
            <a
              href={social.url}
              aria-label={social.ariaLabel}
              class="text-indian-red-500 hover:text-indian-red-600"
              target="_blank"
              rel="noopener noreferrer"
              set:html={social.icon}
            />
          ))
        }
      </div>
    </div>
  </div>
</header>

<style>
  /* Ensure header doesn't overflow on mobile */
  #main-header {
    width: 100%;
    max-width: 100vw;
    overflow-x: hidden;
  }

  .header-second-bar,
  .header-top-bar {
    width: 100%;
    max-width: 100vw;
    box-sizing: border-box;
  }

  /* Animated underline for desktop links */
  .nav-link::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background-color: #cd5c5c; /* indian-red-500 */
    transition: width 0.3s ease;
  }

  .nav-link:hover::after {
    width: 100%;
  }

  /* Mobile responsive adjustments */
  @media (max-width: 768px) {
    #main-header,
    .header-second-bar,
    .header-top-bar {
      width: 100vw;
      max-width: 100vw;
    }
  }
</style>

<script>
  import { gsap } from "gsap";

  document.addEventListener("DOMContentLoaded", () => {
    // Initial Animation
    // Initial Animation
    const tl = gsap.timeline({ defaults: { ease: "power3.out" } });

    tl.from("#main-header", {
      y: "-100%",
      opacity: 0,
      duration: 0.5,
    })
      .from(
        ".header-top-bar",
        {
          y: "-100%",
          opacity: 0,
          duration: 1,
        },
        "-=0.5"
      )
      .from(
        ".header-second-bar",
        {
          x: "-100%",
          opacity: 0,
          duration: 0.5,
        },
        "-=0.3"
      )
      .from(
        ".header-nav-item",
        {
          y: -10,
          opacity: 0,
          duration: 1,
          stagger: 0.1,
        },
        "-=0.1"
      )
      .from(
        ".header-cta",
        {
          scale: 0.8,
          autoAlpha: 0,
          duration: 0.5,
          ease: "back.out(1.1)",
        },
        "-=0.3"
      )
      .from(
        "#mobile-menu-btn",
        {
          scale: 0.8,
          opacity: 0,
          duration: 0.5,
        },
        "<"
      );

    // Mobile Menu Toggle
    const menuBtn = document.getElementById("mobile-menu-btn");
    const mobileMenu = document.getElementById("mobile-menu");
    const menuIcon = menuBtn?.querySelector(".menu-icon");
    const closeIcon = menuBtn?.querySelector(".close-icon");
    let isMenuOpen = false;

    menuBtn?.addEventListener("click", () => {
      isMenuOpen = !isMenuOpen;

      if (isMenuOpen) {
        // Open Menu
        mobileMenu?.classList.remove("-translate-y-[150%]", "-z-10");
        mobileMenu?.classList.add("translate-y-0", "top-20"); // top-20 matches header height
        menuIcon?.classList.add("hidden");
        closeIcon?.classList.remove("hidden");

        // Animate items
        if (mobileMenu && mobileMenu.children[0]) {
          gsap.fromTo(
            mobileMenu.children[0].children,
            { y: -20, opacity: 0 },
            {
              y: 0,
              opacity: 1,
              duration: 0.4,
              stagger: 0.1,
              ease: "power2.out",
            }
          );
        }
      } else {
        // Close Menu
        mobileMenu?.classList.remove("translate-y-0", "top-20");
        mobileMenu?.classList.add("-translate-y-[150%]", "-z-10");
        menuIcon?.classList.remove("hidden");
        closeIcon?.classList.add("hidden");
      }
    });

    // Close mobile menu when clicking a link
    const mobileLinks = mobileMenu?.querySelectorAll("a");
    mobileLinks?.forEach((link) => {
      link.addEventListener("click", () => {
        isMenuOpen = false;
        mobileMenu?.classList.remove("translate-y-0", "top-20");
        mobileMenu?.classList.add("-translate-y-[150%]", "-z-10");
        menuIcon?.classList.remove("hidden");
        closeIcon?.classList.add("hidden");
      });
    });
  });
</script>
